(()=>{"use strict";var t=function(){function t(n){void 0===n&&(n=t.flat),this.orientation=n,this.offsets=new Map;var i=Math.sqrt(3);this.orientation==t.flat?(this.offsets.set(0,new e(-2,0)),this.offsets.set(1,new e(-1,-i)),this.offsets.set(2,new e(1,-i)),this.offsets.set(3,new e(2,0)),this.offsets.set(4,new e(1,i)),this.offsets.set(5,new e(-1,i))):(this.offsets.set(0,new e(0,-2)),this.offsets.set(1,new e(i,-1)),this.offsets.set(2,new e(i,1)),this.offsets.set(3,new e(0,2)),this.offsets.set(4,new e(-i,1)),this.offsets.set(5,new e(-i,-1)))}return t.prototype.getOffsetX=function(t){var e;return(null===(e=this.offsets.get(t))||void 0===e?void 0:e.x)||0},t.prototype.getOffsetY=function(t){var e;return(null===(e=this.offsets.get(t))||void 0===e?void 0:e.y)||0},t.flat="flat",t.pointy="pointy",t}(),e=function(t,e){this.x=t,this.y=e},n=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.json=function(){return JSON.stringify(this)},t}(),i=function(){function t(){if(this.i=0,this.canvas=document.getElementById("canvas"),null==this.canvas)throw new Error("Canvas is not found");this.context=this.canvas.getContext("2d");var t=window.devicePixelRatio;this.canvas.width=1e3,this.canvas.height=700,this.context.scale(t,t)}return t.prototype.circle=function(t,e,n,i){void 0===n&&(n=!1),void 0===i&&(i="grey"),this.context.beginPath(),this.context.fillStyle=i,this.context.arc(t.x,t.y,e,0,2*Math.PI),n&&this.context.fill(),this.context.lineWidth=0,this.context.stroke()},t.prototype.line=function(t,e,n){void 0===n&&(n="black"),this.context.beginPath(),this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this.context.strokeStyle=n,this.context.fillStyle=n,this.context.lineWidth=5,this.context.stroke(),this.context.strokeStyle="black",this.context.fillStyle="black",this.context.lineWidth=1},t.prototype.clear=function(){var t=this.context.createLinearGradient(0,0,this.canvas.width,0);t.addColorStop(0,"#e8e6df"),t.addColorStop(.5,"#e6e1d3"),t.addColorStop(1,"#e8e6df"),this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},t}(),r=function(t,e){void 0===e&&(e=!1),this.center=t,this.isMain=e,this.neighbors=new Map,this.pattern=[0,0,0,0,0,0],this.randomPattern=[0,0,0,0,0,0]},o=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},s=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s},a=function(t,e,n){if(n||2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))};new(function(){function e(e,o,s){if(void 0===o&&(o=1),void 0===s&&(s=t.flat),this.size=e,this.levelCount=o,this.items=new Map,this.canvas=new i,this.visited=new Set,this.contreAngles={0:3,1:4,2:5,3:0,4:1,5:2},this.orientation=new t(s),this.levelCount<1)throw Error("Level count should be bigger than 0.");this.center=new n(this.canvas.canvas.width/2,this.canvas.canvas.height/2),this.startItem=new r(this.center),this.defineMouseListeners(),this.buildLevels(),this.buildTree(),this.render()}return e.prototype.defineMouseListeners=function(){var t=this,e=function(e){t.onLeftClick(e)};e.bind(this),this.canvas.canvas.addEventListener("click",e,!1);var n=function(e){t.onRightClick(e)};n.bind(this),this.canvas.canvas.addEventListener("contextmenu",n,!1)},e.prototype.buildTree=function(){var t=Array.from(this.items.keys());this.startItem=this.items.get(t[this.getRandomValue(t.length)]),this.startItem.isMain=!0,this.buildGraphItems(this.startItem),this.randomlyTurnItems()},e.prototype.randomlyTurnItems=function(){var t,n;try{for(var i=o(Array.from(this.items.values())),r=i.next();!r.done;r=i.next()){var h=r.value;h.randomPattern=a([],s(h.pattern),!1);var l=this.getRandomValue(5);this.turnItem(h,l,e.left)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.buildGraphItems=function(t){var e,n;if(!this.visited.has(t)){this.visited.add(t);var i=this.shuffle(Array.from(t.neighbors.keys()));try{for(var r=o(i),s=r.next();!s.done;s=r.next()){var a=s.value,h=t.neighbors.get(a);this.visited.has(h)||(t.pattern[a]=1,h.pattern[this.contreAngles[a]]=1,this.buildGraphItems(h))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}},e.prototype.buildActivePath=function(t){var e,n;if(!this.visited.has(t)){this.visited.add(t);try{for(var i=o(t.neighbors.entries()),r=i.next();!r.done;r=i.next()){var a=s(r.value,2),h=a[0],l=a[1];this.hasConnectedItem(t,l,h)&&(this.renderItem(t,!0),this.buildActivePath(l))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}},e.prototype.hasConnectedItem=function(t,e,n){return!(!t.randomPattern[n]||1!=t.randomPattern[n]||!e.randomPattern[this.contreAngles[n]]||1!=e.randomPattern[this.contreAngles[n]])},e.prototype.render=function(){var t,e;this.canvas.clear();try{for(var n=o(this.items.values()),i=n.next();!i.done;i=n.next()){var r=i.value;this.renderItem(r)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.visited.clear(),this.buildActivePath(this.startItem)},e.prototype.renderItem=function(t,e){for(var n in void 0===e&&(e=!1),t.randomPattern)if(1==t.randomPattern[n]){var i=this.getPointWithOffset(t.center,Number(n),!1),r=e||t.isMain?"red":"black";this.canvas.line(t.center,i,r)}this.canvas.circle(t.center,3,!0)},e.prototype.getRandomValue=function(t){return Math.floor(Math.random()*t)},e.prototype.buildLevels=function(){var t=new r(this.center);this.items.set(t.center.json(),t),this.buildLevel(t,1),this.addNeighbors()},e.prototype.pointBelongCircle=function(t){var e,n;try{for(var i=o(this.items.values()),r=i.next();!r.done;r=i.next()){var s=r.value;if(Math.pow(t.x-s.center.x,2)+Math.pow(t.y-s.center.y,2)<=Math.pow(this.size,2))return s}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return null},e.prototype.addItem=function(t){var e,n=t.json();return this.items.has(n)?e=this.items.get(n):(e=new r(t),this.items.set(n,e)),e},e.prototype.turnItem=function(t,e,n){t.randomPattern=this.shift(t.randomPattern,e,n),this.render()},e.prototype.buildLevel=function(t,n){if(!(++n>this.levelCount))for(var i=0;i<e.anglesCount;i++){var r=this.getPointWithOffset(t.center,i),o=this.addItem(r);this.buildLevel(o,n)}},e.prototype.shift=function(t,n,i){for(var r=0;r<n;r++)if(i==e.left){var o=t.pop();t.unshift(o)}else o=t.shift(),t.push(o);return t},e.prototype.getPointWithOffset=function(t,e,i){void 0===i&&(i=!0);var r=i?1:2;return new n(+(t.x+this.size*this.orientation.getOffsetX(e)/r).toFixed(2),+(t.y+this.size*this.orientation.getOffsetY(e)/r).toFixed(2))},e.prototype.addNeighbors=function(){var t,n;try{for(var i=o(this.items.values()),r=i.next();!r.done;r=i.next())for(var s=r.value,a=0;a<e.anglesCount;a++){var h=this.getPointWithOffset(s.center,a);this.items.has(h.json())&&s.neighbors.set(a,this.items.get(h.json()))}}catch(e){t={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.onLeftClick=function(t){var n=this.pointBelongCircle(this.getCanvasClickedPoint(t));n&&0==t.button&&this.turnItem(n,1,e.left)},e.prototype.getCanvasClickedPoint=function(t){var e=this.canvas.canvas.getBoundingClientRect(),i=t.clientX-e.left,r=t.clientY-e.top;return new n(i,r)},e.prototype.onRightClick=function(t){t.preventDefault();var n=this.pointBelongCircle(this.getCanvasClickedPoint(t));n&&2==t.button&&this.turnItem(n,1,e.right)},e.prototype.shuffle=function(t){for(var e,n=[],i=t.length;i;)(e=Math.floor(Math.random()*t.length))in t&&(n.push(t[e]),delete t[e],i--);return n},e.left="left",e.right="right",e.anglesCount=6,e}())(20,6,t.flat)})();